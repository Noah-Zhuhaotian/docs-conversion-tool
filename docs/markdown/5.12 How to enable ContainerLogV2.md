5.12 How to enable ContainerLogV2

Currently our original schema is ContainerLog, ContainerLogV2 will be the default schema if we create a new cluster and ContainerLog table will be retired on 30th September 2026. This documentation is aimed to enable ContainerLogV2.

For more information, see the following article:

[Configure the ContainerLogV2 schema for Container Insights - Azure Monitor | Microsoft Learn](https://learn.microsoft.com/en-us/azure/azure-monitor/containers/container-insights-logs-schema)

Steps:

1. Run the below pipeline to enable the “ContainerLogV2”.

[Pipelines - Runs for APM0004459-Aks Cluster Management Update ContianerLogV2 in Azure insight](https://dev.azure.com/dow-vsts/DevSecOps/_build?definitionId=8225)

1. Choose the “main” branch
2. Select the name of the cluster

![](data:image/png;base64...)

1. Choose the type of MonitorSettings (Choose “Cost-optimized” by default):

![A white background with black text  Description automatically generated](data:image/png;base64...)

1. (Optional) Enter the proper “ChangeNumber” if you run it for Production:

![](data:image/png;base64...)

1. Go to the Portal to Check the configuration of the insight if it has been configured as “ContainerLogV2”

[AKS-NP-002 - Microsoft Azure](https://portal.azure.com/?feature.msaljs=true#@bsnconnect.onmicrosoft.com/resource/subscriptions/6060ea50-d00d-4c40-8219-546ed259f9e5/resourceGroups/RG-NP-0001581/providers/Microsoft.ContainerService/managedClusters/AKS-NP-002/infrainsights)

![](data:image/png;base64...)

![A screenshot of a computer  Description automatically generated](data:image/png;base64...)

1. Modify the ConfigMaps of the pods which are used as agents for Azure Monitoring.

[Pipelines - Runs for APM0004459-AksBasic (azure.com)](https://dev.azure.com/dow-vsts/DevSecOps/_build?definitionId=3896)

1. Choose the “main” branch
2. Select the name of the cluster

![](data:image/png;base64...)

1. Choose the deployment:

![](data:image/png;base64...) ![A close-up of a search box  Description automatically generated](data:image/png;base64...)

1. (Optional) Enter the proper “ChangeNumber” if you run it for Production:

![A white and black pencil  Description automatically generated with medium confidence](data:image/png;base64...)

1. Go to the Portal to Check the configuration and use the below query in the insight if it has been configured as “ContainerLogV2”.
2. Click the “Configuration”:

[AKS-SB-001 - Microsoft Azure](https://portal.azure.com/?feature.msaljs=true#@bsnconnect.onmicrosoft.com/resource/subscriptions/6060ea50-d00d-4c40-8219-546ed259f9e5/resourceGroups/RG-T-0003321/providers/Microsoft.ContainerService/managedClusters/AKS-SB-001/overview)

[AKS-NP-002 - Microsoft Azure](https://portal.azure.com/?feature.msaljs=true#@bsnconnect.onmicrosoft.com/resource/subscriptions/6060ea50-d00d-4c40-8219-546ed259f9e5/resourceGroups/RG-NP-0001581/providers/Microsoft.ContainerService/managedClusters/AKS-NP-002/configuration)

[AKS-PD-002 - Microsoft Azure](https://portal.azure.com/?feature.msaljs=true#@bsnconnect.onmicrosoft.com/resource/subscriptions/6060ea50-d00d-4c40-8219-546ed259f9e5/resourceGroups/RG-PD-0001547/providers/Microsoft.ContainerService/managedClusters/AKS-PD-002/overview)

![](data:image/png;base64...)

1. Filter the ConfigMap:

ConfigMap: container-azm-ms-agentconfig

Namespace: kube-system

![](data:image/png;base64...)

1. Click this ConfigMap:

![](data:image/png;base64...)

1. Check the Configuration and use the tool “Find” of your browser.

Make sure these two Parameters have been configured as the below pictures.

![](data:image/png;base64...)

![](data:image/png;base64...)

1. Go to the “logs” to check the table called ContainerLogV2 if it has the data, and the logs if they are already multiline.

![](data:image/png;base64...)

Run the following scripts to make sure the table has the new data and the logs are multiline.

ContainerLogV2

| project TimeGenerated, LogMessage, PodName, PodNamespace

| where PodNamespace contains "apm0005739"

| where LogMessage contains "System"

![](data:image/png;base64...)